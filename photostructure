#!/usr/bin/env node
/* Copyright © 2020, PhotoStructure Inc. <https://photostructure.com/eula> */
module.exports=function(t){var n={};function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(n){return t[n]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=362)}({0:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(49);function i(t,n){return null==t?void 0:n(t)}function o(t,n,e){return null==t||null==n?void 0:e(t,n)}function u(t,n){return null!=t?t:r.tot(n)}function l(t){return null!=t}n.map=i,n.mapTry=function(t,n){try{return i(t(),n)}catch(t){return}},n.map2=o,n.map3=function(t,n,e,r){return null==t||null==n||null==e?void 0:r(t,n,e)},n.orElse=u,n.mapOr=function(t,n,e){return null==t?e():n(t)},n.map2Or=function(t,n,e,r){return u(o(t,n,e),r)},n.defined=l,n.allDefined=function(t){return null!=t&&t.every(l)},n.firstDefined=function(...t){return t.find(l)},n.denull=function(t){return null==t?void 0:t},n.nulled=function(t){return null==t?null:t}},1:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(3),i=e(96),o=e(191),u=e(48),l=e(0),c=e(53),s=e(97),a=e(17),f=e(7);function p(t){return o.isList(t)&&t.length>0&&t.some(t=>null!=t)}function m(t){return!p(t)}function d(t){return c.isPrimitive(t)||c.isPrimitiveArray(t)?t:t.valueOf()}function h(t,n){for(let e=0;e<t.length;e++)n[e]=t[e];return n.length=t.length,n}function y(t,n){return h(g(t,n),t)}function g(t,n){return a.toA(t).filter(t=>null!=t).map((t,e)=>({item:t,cmp:l.map(n(t),t=>[t,e])})).filter(t=>null!=t.cmp).sort((t,n)=>c.cmp(t.cmp,n.cmp)).map(t=>t.item)}function b(t,n){return null!=t&&null!=n&&t.length===n.length&&t.every((t,e)=>t===n[e])}function v(t,n,e){if(n===e||n<0||e<0||n>=t.length||e>=t.length)return t;const r=t[n];return t.splice(n,1),t.splice(e,0,r),t}function M(t,n){if(null==t)return!1;for(const e of t)if(n.valueOf()===e.valueOf())return!0;return!1}function O(t){if(null==t)return[];const n=a.toA(t);return n.every(l.defined)?n:n.filter(l.defined)}n.isNotEmpty=p,n.isEmpty=m,n.mapArray=function(t,n){return Array.isArray(t)?n(t):void 0},n.mapNotEmpty=function(t,n){return p(t)?n(t):void 0},n.flatten=function(t,n=[]){if(null==t)return n;for(const e of t)null!=e&&(Array.isArray(e)?n.push(...O(e)):n.push(e));return n},n.sort=function(t){return y(O(t),d)},n.replaceContents=h,n.sortByInPlace=y,n.sortUniqByInPlace=function(t,n){const e=new Map;for(const r of t)u.getOrSet(e,JSON.stringify(n(r)),()=>r);return h(g(e.values(),n),t)},n.sorted=function(t){return t.every((n,e)=>0===e||n>t[e-1])},n.sortBy=g,n.deepSortBy=function t(n,e){return g(n,e).map(n=>i.isIterable(n)?t(n,e):n)},n.arrayEql=b,n.startsWith=function(t,n){return b(t.slice(0,n.length),n)},n.filterInPlace=function(t,n){for(let e=0;e<t.length;)n(t[e],e,t)?e++:t.splice(e,1);return t},n.move=v,n.includes=M,n.indexOf=function(t,n){if(null==t)return;let e=0;for(const r of t){if(n(r,e))return e;e++}},n.includesAll=function(t,n){return null!=t&&null!=n&&n.every(n=>M(t,n))},n.pushUniq=function(t,n){return M(t,n)||t.push(n),t},n.insertAt=function(t,n,...e){return t.splice(n,0,...e),t},n.insertUniq=function(t,n,e){for(let n=0;n<t.length-1;n++)if(e(t[n],t[n+1])>0)throw new Error("badly sorted array: "+t);for(let r=0;r<t.length;r++){const i=e(t[r],n);if(0===i)return t;if(i>0)return t.splice(r,0,n),t}return t.push(n),t},n.compact=O;const j=["","null","undefined"];function S(t,n=(t=>JSON.stringify(t))){if(m(t))return[];const e=new Map;return t.forEach(t=>l.map(t,t=>u.getOrSet(e,n(t),()=>t))),[...e.values()]}function x(t,n,e=1,r=(t=>t)){const i=[];if(t<n)for(let o=t;o<n;o+=e)i.push(r(o));else for(let o=t;o>n;o-=e)i.push(r(o));return i}n.compactBlankish=function(t){return a.toA(t).filter(t=>r.notBlank(t)&&!j.includes(f.toS(t).trim()))},n.compactBlanks=function(t){return null==t?[]:t.map(t=>f.toS(t).trim()).filter(t=>t.length>0)},n.uniq=function(t){return S(O(t),t=>JSON.stringify(t))},n.uniqBy=S,n.clear=function(t){return t.length=0,t},n.count=function(t,n){return t.reduce((t,e,r)=>t+(n(e,r)?1:0),0)},n.sum=function(t,n){return t.reduce((t,e,r)=>t+n(e,r),0)},n.firstMatch=function(t,n){for(const e of O(n)){const n=t.exec(e);if(null!=n)return n}},n.commonPrefixLength=function(t,n){if(null==t||null==n)return 0;if(t===n)return t.length;if("string"==typeof t&&(t=t.split("")),"string"==typeof n&&(n=n.split("")),b(t,n))return t.length;let e=0;for(;t[e]===n[e];)e++;return e},n.anneal=function({array:t,expense:n,allowedDelta:e}){const r=Math.round(e);if(r<2)return t;for(let e=0;e<t.length-1;e++){const i=s.randomInt(Math.max(0,e-r),Math.min(t.length,e+r),[e]);if(null==i)continue;const o=Math.max(0,Math.min(i,e)-1),u=Math.min(t.length,Math.max(i,e)+1),l=n(t,o,u);v(t,e,i);const a=n(t,o,u);c.lt(l,a)&&v(t,i,e)}return t},n.range=function(t,n,e=(t=>t)){return x(t,n,1,e)},n.stepRange=x},101:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(1),i=e(7);function o(t,n){return t=i.toS(t),n=i.toS(n),t.startsWith(n)?t:n+t}n.ensurePrefix=o,n.ensureSuffix=function(t,n){return t=i.toS(t),n=i.toS(n),t.endsWith(n)?t:t+n},n.newlineRe=/\r?\n/gm,n.wrap=function t(e,u={maxLineLen:75,prefix:""}){if(e.includes("\n"))return r.flatten(e.split(n.newlineRe).map(n=>t(n,u)));if((e=o(i.toS(e).trim(),u.prefix)).length<=u.maxLineLen)return[e.trim()];const l=e.slice(0,u.maxLineLen+1).replace(/[\s-]/g," ").lastIndexOf(" "),c=l<=1?u.maxLineLen-(u.prefix.length+2):l;return[e.slice(0,c+1).trim(),...t(e.slice(c+1),u)]},n.eqlStrings=function(t,n){return null!=t&&null!=n&&t.normalize()==n.normalize()}},15:function(t,n,e){"use strict";var r;Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.isDefined=!1,t.isEmpty=!0,t.get=function(){},t.exists=()=>!1;const n=()=>t;t.map=n,t.flatMap=n,t.filter=n,t.forEach=n,t.getOrElse=function(t){return t()},t.orElse=function(t){return o(t())},t.zip1=n,t.zip2=n,t.zip3=n}(r||(r={})),n.None=r;class i{constructor(t){this.a=t,this.isDefined=!0,this.isEmpty=!1}get(){return this.a}exists(t){return t(this.a)}map(t){return new i(t(this.a))}flatMap(t){const n=t(this.a);return u(n)?n:o(n)}filter(t){return o(t(this.a)?this.a:void 0)}forEach(t){return t(this.a),this}getOrElse(t){return this.a}orElse(t){return this}zip1(t,n){return o(t).flatMap(t=>n(this.a,t))}zip2(t,n,e){return o(t).flatMap(t=>o(n).flatMap(n=>e(this.a,t,n)))}zip3(t,n,e,r){return o(t).flatMap(t=>o(n).flatMap(n=>o(e).flatMap(e=>r(this.a,t,n,e))))}}function o(t){return u(t)?t:null!=t?new i(t):n.None}function u(t){return t instanceof i||t===n.None}n.Some=i,n.Opt=o,n.isOpt=u},17:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(96);n.toA=function(t){return null==t?[]:r.isIterable(t)?Array.from(t):Array.isArray(t)?t:[t]}},188:function(t,n){("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"0.8.0-beta.1+20200423195810"}},189:function(t,n){t.exports=require("commander")},19:function(t,n){t.exports=require("process")},190:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(19),i=e(101),o=(new Date).getFullYear();n.descriptionFooter=`Please visit <https://photostructure.com/support/> for detailed usage and configuration instructions.\n\nCopyright © ${o}, PhotoStructure Inc.\n\nRunning this software indicates your agreement to all the terms of this license: <https://photostructure.com/eula>`,n.CliDesc={main:"Launches PhotoStructure. Manages web and sync services.",info:"Configuration, file metadata and import diagnostics tool. ",ls:"List all paths in a Library. Use --json or --dump with `jq` to extract columns.",logtail:"View the log messages of currently-running PhotoStructure processes. (Like `tail -f`).",web:"Web service. Automatically started by main.",db:"DB service. Normally runs within the web service.",sync:"Directory synchronization service. Automatically started by main.",syncFile:"File synchronization service. Automatically started by sync."},n.addFooter=function(t){return t.on("--help",()=>{var t;console.log("\n"+i.wrap(n.descriptionFooter,{maxLineLen:null!==(t=r.stdout.columns)&&void 0!==t?t:78,prefix:""}).join("\n")+"\n")})}},191:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(34);n.isList=function(t){return null!=t&&(Array.isArray(t)||isFinite(t.length)&&r.isFunction(t[Symbol.iterator])&&r.isFunction(t.push)&&r.isFunction(t.pop)&&r.isFunction(t.forEach)&&r.isFunction(t.some))}},3:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(0),i=e(49),o=e(17),u=e(7);function l(t){if(null==t)return!0;const n=u.toS(t);return 0===n.length||0===n.trim().length}function c(t){return!l(t)}function s(t,n){if(!1===t||null==t||""===t)return;const e=u.toS(t);return c(e)?n(e):void 0}n.blank=l,n.notBlank=c,n.ifNotBlank=function(t){if(null==t)return;const n=u.toS(t);return 0===n.length||0===n.trim().length?void 0:n},n.notBlankOr=function(t,n){if(null==t)return i.tot(n);const e=u.toS(t).trim();return e.length>0?e:i.tot(n)},n.notBlankAnd=function(t,n){return!l(t)&&n(t)},n.mapNotBlank=s,n.mapNotBlankOr=function(t,n,e){return r.orElse(s(t,n),e)},n.firstNotBlank=function(...t){return o.toA(t).find(t=>c(t))}},34:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(96),i=e(53);var o;function u(t){return"symbol"==typeof t}function l(t){return"function"==typeof t}function c(t){return null==t?o.Empty:u(t)?o.Symbol:i.isPrimitive(t)?o.Primitive:Array.isArray(t)?o.Array:r.isIterable(t)?o.Iterable:l(t)?o.Function:"object"==typeof t?t.constructor&&"Object"===t.constructor.name?o.Object:o.Instance:o.Unknown}!function(t){t[t.Empty=0]="Empty",t[t.Primitive=1]="Primitive",t[t.Symbol=2]="Symbol",t[t.Object=3]="Object",t[t.Array=4]="Array",t[t.Iterable=5]="Iterable",t[t.Instance=6]="Instance",t[t.Function=7]="Function",t[t.Unknown=8]="Unknown"}(o=n.ObjectType||(n.ObjectType={})),n.isSymbol=u,n.isFunction=l,n.isObject=function(t){return c(t)===o.Object},n.objectType=c},362:function(t,n,e){e(188),t.exports=e(363)},363:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(189),i=e(19),o=e(61),u=e(190);r.program.version(o.version),r.program.description("PhotoStructure™, your new home for all your photos and videos."),u.addFooter(r.program).command("main",u.CliDesc.main,{isDefault:!0,executableFile:"bin/main.js"}).command("info",u.CliDesc.info,{executableFile:"bin/info.js"}).command("ls",u.CliDesc.info,{executableFile:"bin/ls.js"}).command("logtail",u.CliDesc.logtail,{executableFile:"bin/logtail.js"}).command("web",u.CliDesc.web,{executableFile:"bin/web.js"}).command("sync",u.CliDesc.sync,{executableFile:"bin/sync.js"}).command("sync-file",u.CliDesc.syncFile,{executableFile:"bin/sync-file.js"}).parse(i.argv)},48:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getOrSet=function(t,n,e){if(null==n)throw new Error("null key");if(t.has(n))return t.get(n);{const r=e();return t.set(n,r),r}}},49:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(34);n.tot=function(t){return r.isFunction(t)?t():t},n.firstDefinedThunk=function(t){for(const n of t){const t=n();if(null!=t)return t}}},5:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(3),i=e(0),o=e(34),u=e(15),l=e(49),c=e(7);function s(t){return"number"==typeof t&&isFinite(t)}function a(t,n){return s(t)?n(t):void 0}function f(t){return b(t,t=>{const n=Math.trunc(t);return 0===n?Math.abs(n):n})}function p(t){return o.isFunction(t.toNumber)}function m(t,n){if(r.blank(t))return n.defaultValue;if(s(t))return n.nton(t);if(p(t))return n.nton(t.toNumber());try{const e=n.ston(c.toS(t));return s(e)?n.nton(e):n.defaultValue}catch(t){return n.defaultValue}}function d(t,n){return m(t,Object.assign({defaultValue:void 0,nton:t=>f(t),ston:parseInt},n))}function h(t,n){return m(t,Object.assign({defaultValue:void 0,nton:t=>t,ston:parseFloat},n))}function y(t){return s(t)&&t>0}function g(t,n){return u.Opt(t).flatMap(t=>d(t)).flatMap(n).get()}function b(t,n){return s(t)?n(t):void 0}function v(t){return t<0?-Math.round(-t):Math.round(t)}function M(t,n){if(null==t)return 0;const e=Math.pow(10,n);return v(t*e)/e}n.isNumber=s,n.mapFinite=a,n.finiteOrElse=function(t,n){return s(t)?t:n},n.diff=function(t,n){return s(t)&&s(n)?t-n:void 0},n.absdiff=function(t,n){return s(t)&&s(n)?Math.abs(t-n):void 0},n.closeTo=function(t,n,e){return null!=t&&null!=n&&Math.abs(t-n)<e},n.trunc=f,n.isToNumber=p,n.toInt=d,n.toFloat=h,n.toGt0=function(t){const n=d(t);return null!=n&&n>0?n:void 0},n.gt0=y,n.gtOrElse=function(t,n){return s(t)&&s(n)&&t>n?t:void 0},n.gte0=function(t){return s(t)&&t>=0},n.mapInt=g,n.mapFloat=function(t,n){return u.Opt(t).flatMap(t=>h(t)).flatMap(n).get()},n.id=function(t){const n=d(t);return y(n)?String(n):void 0},n.mapIntOr=function(t,n,e){return i.orElse(g(t,n),e)},n.mapNumeric=b,n.map2Numeric=function(t,n,e){return b(t,t=>b(n,n=>e(t,n)))},n.mapNumericOr=function(t,n,e){return s(t)?n(t):e},n.numericOr=function(t,n){return s(t)?t:l.tot(n)},n.round=v,n.toPrecisionMaybe=function(t,n){return a(t,t=>M(t,n))},n.toFixed=function(t,n){try{return b(t,t=>v(t*Math.pow(10,n))/Math.pow(10,n))}catch(t){return}},n.toPrecision=M,n.sigFigs=function(t,n){if(0===t||0===n)return 0;const e=Math.pow(10,n-v(Math.ceil(Math.log10(Math.abs(t)))));return v(t*e)/e},n.base2Ceil=function(t){return Math.pow(2,Math.ceil(Math.log2(t)))},n.base10Ceil=function(t){return Math.pow(10,Math.ceil(Math.log10(t)))},n.clamp=function(t,n,e){return s(e)?([t,n]=[Math.min(t,n),Math.max(t,n)],Math.max(t,Math.min(e,n))):v((t+n)/2)},n.times=function(t,n){if(!y(t))return[];const e=Math.round(t);return e<=0?[]:[...Array(e)].map((t,e)=>n(e))}},53:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(1),i=e(7),o=["number","string","boolean"];function u(t){return-1!==o.indexOf(typeof t)}n.isPrimitive=u,n.mapPrimitive=function(t,n){return u(t)?n(t):void 0},n.mapPrimitiveOr=function(t,n,e){return u(t)?n(t):e()},n.isPrimitiveArray=function(t){return Array.isArray(t)&&t.every(u)};const l=["boolean","number","bigint","symbol","string","object","function"];function c(t,n){if(null==t&&null==n)return 0;if(null==t)return-1;if(null==n)return 1;const e=typeof t,r=typeof n;return"string"!==e&&"symbol"!==e||"string"!==r&&"symbol"!==r?Array.isArray(t)&&Array.isArray(n)?s(t,n):e!==r?l.indexOf(e)-l.indexOf(r):t>n?1:t<n?-1:0:i.toS(t).localeCompare(i.toS(n))}function s(t,n){if(r.isEmpty(t)&&r.isEmpty(n))return 0;const e=Math.min(t.length,n.length);for(let r=0;r<e;r++){const e=c(t[r],n[r]);if(0!==e)return e}return c(t.length,n.length)}n.cmp=c,n.lt=function(t,n){return c(t,n)<0},n.lte=function(t,n){return c(t,n)<=0},n.gte=function(t,n){return c(t,n)>=0},n.gt=function(t,n){return c(t,n)>0},n.cmpArr=s},61:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.version="0.8.0-beta.1",n.release="0.8.0-beta.1+20200423195810",n.gitSha="ffb0cf744e74965e028090d96a9ee882a4e70824",n.gitDate=new Date(158767189e4)},7:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.toS=function t(n){return null==n?"":"string"==typeof n?n:Array.isArray(n)?n.map(t).join(","):n.toString()}},96:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isIterable=function(t){return null!=t&&"string"!=typeof t&&"function"==typeof t[Symbol.iterator]}},97:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const r=e(1),i=e(5);function o(t,n,e=[]){if(t=Math.ceil(t),n=Math.floor(n),r.isNotEmpty(e)&&e.length+10>n-t){const i=r.range(t,n).filter(t=>!e.includes(t));return r.mapNotEmpty(i,t=>t[o(0,i.length)])}const i=Math.floor(Math.random()*(n-t))+t;return e.includes(i)?o(t,n,e):i}function u(t,n){return Math.random()*(n-t)+t}function l(){return n.RandomChars[o(0,n.RandomChars.length)]}function c(t){const n=Array(...t);for(let t=n.length-1;t>0;t-=1){const e=Math.floor(Math.random()*(t+1));t!==e&&([n[t],n[e]]=[n[e],n[t]])}return n}n.randomInt=o,n.randomInts=function(t,n,e){const r=[];for(;r.length<e;)r.push(o(t,n,r));return r},n.randomFloat=u,n.RandomChars="0123456789abcdefghijkmnopqrstuvwxyz",n.randomChars=function(t){let n="";for(let e=0;e<t;e++)n+=l();return n},n.randomChar=l,n.pickRandom=function(...t){return t[o(0,t.length)]},n.shuffle=c,n.sample=function(t,n){if(n<t.length/10){const e=new Set;for(;e.size<n;)e.add(o(0,t.length));return[...e.keys()].map(n=>t[n])}return c([...t]).slice(0,n)},n.pickWeightedRandom=function(t){if(r.isEmpty(t))return;const n=t.filter(t=>i.gt0(t.priority));let e=u(0,r.sum(n,t=>t.priority));return n.find(t=>(e-=t.priority,e<=0))}}});